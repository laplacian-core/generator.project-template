#!/usr/bin/env bash
set -e
SCRIPT_BASE_DIR=$(cd $"${BASH_SOURCE%/*}" && pwd)
PROJECT_BASE_DIR=$(cd $SCRIPT_BASE_DIR && cd .. && pwd)

LOCAL_REPO_PATH="$PROJECT_BASE_DIR/../mvn-repo"

normalize_path () {
  local path=$1
  if [[ $path == /* ]]
  then
    echo $path
  else
    echo "${PROJECT_BASE_DIR}/$path"
  fi
}

#
# Generate resources for {{project.name}} project.
#
${SCRIPT_BASE_DIR}/laplacian-generate.sh \
  {{#each project.schemas as |schema|}}
  --schema '{{schema.group}}:{{schema.group}}.{{schema.name}}:{{schema.version}}' \
  {{/each}}
  {{#each project.templates as |template| ~}}
  --template '{{template.group}}:{{template.group}}.{{template.name}}:{{template.version}}' \
  {{/each}}
  {{#each project.models as |model| ~}}
  --model '{{model.group}}:{{model.group}}.{{model.name}}:{{model.version}}' \
  {{/each}}
  --model-files './model/project.yaml' \
  {{#each project.model_files as |files| ~}}
  --model-files $(normalize_path '{{files}}') \
  {{/each}}
  {{#each project.template_files as |files| ~}}
  --template-files $(normalize_path '{{files}}') \
  {{/each}}
  --target-dir ./ \
  --local-repo "$LOCAL_REPO_PATH"
